# this script is designed to be run from a UNIX like shell under Windows 
# and has some hard coded assumptions. Do not just randomly run this script 
# without looking it over first.

# Release version number.
SET (TAG 
  "CMake-@CMake_VERSION_MAJOR@-@CMake_VERSION_MINOR@-@CMake_VERSION_PATCH@")
SET (VERSION 
  "@CMake_VERSION_MAJOR@.@CMake_VERSION_MINOR@.@CMake_VERSION_PATCH@")

SET (SCPID "kitware@public.kitware.com")

# CVSROOT setting used to check out CMake.
SET (CVSROOT ":pserver:anoncvs@www.cmake.org:/cvsroot/CMake")

# build the NSI
EXEC_PROGRAM("@NSIS_MAKENSIS@" 
  ARGS "@PROJECT_BINARY_DIR@/Utilities/Release/@PROJECT_NAME@.nsi"
)

# copy the NSI to the FTP site
EXEC_PROGRAM(scp 
  ARGS cmake-${VERSION}-win32.exe
  ${SCPID}:/projects/FTP/pub/cmake/v@CMake_VERSION_MAJOR@.@CMake_VERSION_MINOR@
  )

# tag the tree
EXEC_PROGRAM(cvs "@PROJECT_SOURCE_DIR@"
  ARGS tag -F ${TAG})

# build the winzip src file and copy it over
EXEC_PROGRAM(rm C:/
  ARGS -rf @PROJECT_NAME@
)
EXEC_PROGRAM(cvs C:/
  ARGS -d ${CVSROOT} export -r ${TAG} @PROJECT_NAME@)
EXEC_PROGRAM("@WINZIP_WZZIP@" "C:/@PROJECT_NAME@"
  ARGS -r -P cmake-${VERSION}.zip)
EXEC_PROGRAM(scp "C:/@PROJECT_NAME@"
  ARGS cmake-${VERSION}.zip 
  ${SCPID}:/projects/FTP/pub/cmake/v@CMake_VERSION_MAJOR@.@CMake_VERSION_MINOR@
  )
